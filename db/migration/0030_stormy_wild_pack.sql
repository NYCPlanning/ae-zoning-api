CREATE MATERIALIZED VIEW "public"."capital_project_tile" AS (select "capital_project"."managing_code" || "capital_project"."id" as "managingCodeCapitalProjectId", "capital_project"."managing_agency" as "managingAgency", SUM("capital_commitment_fund"."value")::double precision as "commitmentsTotal", ARRAY_TO_JSON(ARRAY_AGG(DISTINCT "capital_commitment"."budget_line_code")) as "agencyBudgets", "capital_project"."mercator_fill", "capital_project"."mercator_label" from "capital_project" left join "capital_commitment" on ("capital_commitment"."capital_project_id" = "capital_project"."id" and "capital_commitment"."managing_code" = "capital_project"."managing_code") left join "capital_commitment_fund" on "capital_commitment_fund"."capital_commitment_id" = "capital_commitment"."id" where "capital_commitment_fund"."capital_fund_category" = 'total' group by "capital_project"."id", "capital_project"."managing_code", "capital_project"."managing_agency", "capital_project"."mercator_fill", "capital_project"."mercator_label");